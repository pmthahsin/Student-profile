<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Student Profile â€” Form</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f3f7fb;
      --panel:#ffffff;
      --accent:#0b57a4;
      --accent-2:#0c88d1;
      --muted:#7b8a99;
      --card:#0d4e8a;
      --glass: rgba(255,255,255,0.06);
      font-family: 'Nunito', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#eaf4ff 0%, #f7fbff 100%);min-height:100vh;color:#123;}
    .wrap{max-width:1200px;margin:28px auto;padding:18px;display:grid;grid-template-columns:360px 1fr;gap:20px;align-items:start}

    .form-panel{background:linear-gradient(135deg,#d9e8ff,#f0f6ff);padding:24px;border-radius:16px;box-shadow:0 10px 30px rgba(15,30,60,0.12);border:1px solid rgba(10,30,60,0.06);backdrop-filter:blur(8px);}
    .form-panel h2{margin:0 0 12px;font-size:20px;color:var(--card)}
    .field{display:flex;flex-direction:column;margin-bottom:12px}
    label{font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], textarea{padding:10px 12px;border:1px solid #e0e7ef;border-radius:8px;font-size:14px;background:#fbfeff}
    textarea{min-height:120px;resize:vertical}
    .file-input{display:flex;gap:8px;align-items:center}
    .file-input input[type=file]{flex:1}
    .small{font-size:12px;color:var(--muted)}
    .btn-row{display:flex;gap:10px;margin-top:14px}
    .btn{padding:9px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
    .btn.primary{background:var(--accent);color:white}
    .btn.ghost{background:white;border:1px solid #d6e7fb;color:var(--accent)}
    .btn.warn{background:#2b9d3b;color:white}
    .muted-note{font-size:12px;color:#9aa9b6;margin-top:8px}

    .footer {
      text-align:center;
      margin-top:14px;
      font-size:12px;
      color:#52606d;
      opacity:0.8;
    }

    .preview-wrap{position:relative}
    .preview{background:linear-gradient(90deg,#0e4f88 0%, #0b63b0 100%);border-radius:10px;padding:26px;color:white;min-height:460px;display:flex;align-items:stretch}
    .preview-header{display:flex;flex-direction:column;gap:8px;flex:1}
    .college-header{display:flex;align-items:center;justify-content:center;gap:12px}
    .college-logo{width:56px;height:56px;border-radius:8px;background:white;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .college-details{text-align:center}
    .college-title{font-size:16px;font-weight:700;letter-spacing:0.6px}
    .college-sub{font-size:11px;opacity:0.9}

    .about-title{text-align:center;color:#ffdd57;font-weight:800;margin-top:6px}

    .content-box{display:flex;gap:20px;margin-top:12px}
    .text-flow{flex:1}
    .bubble{background:rgba(255,255,255,0.12);padding:12px 14px;border-radius:10px;margin-bottom:10px;font-size:13px;line-height:1.45}

    .photo-card{width:230px;display:flex;flex-direction:column;align-items:center;gap:12px}
    .photo-frame{width:180px;height:230px;border-radius:14px;overflow:hidden;border:6px solid rgba(255,255,255,0.06);background:linear-gradient(180deg,#ffffff11,#ffffff06);display:flex;align-items:center;justify-content:center}
    .photo-frame img{width:100%;height:100%;object-fit:cover}
    .tag{background:white;color:#0d4e8a;padding:10px;border-radius:10px;min-width:160px;text-align:left;font-weight:700}
    .tag small{display:block;font-weight:400;color:#073659}

    .preview-controls{position:absolute;left:20px;right:20px;bottom:-18px;display:flex;gap:10px;justify-content:flex-end}

    @media (max-width:980px){.wrap{grid-template-columns:1fr;max-width:760px}.preview{min-height:520px}}
  </style>
</head>

<body>

  <div class="wrap">
    <div class="form-panel" id="formPanel">
      <h2>Student Profile â€” Form</h2>

      <div class="field">
        <label>College Logo (upload)</label>
        <div class="file-input">
          <input type="file" id="collegeLogoInput" accept="image/*">
          <button class="btn ghost" id="resetCollegeLogo" type="button">Reset</button>
        </div>
        <div class="small muted-note">Square logos work best.</div>
      </div>

      <div class="field">
        <label>Student Photo (upload)</label>
        <div class="file-input">
          <input type="file" id="studentPhotoInput" accept="image/*">
          <button class="btn ghost" id="resetStudentPhoto" type="button">Reset</button>
        </div>
      </div>

      <div class="field">
        <label>Name</label>
        <input type="text" id="nameInput" placeholder="Full name">
      </div>

      <div class="field">
        <label>USN</label>
        <input type="text" id="usnInput" placeholder="USN">
      </div>

      <div class="field">
        <label>Description / About</label>
        <textarea id="descInput" placeholder="Write a short description about yourself .You can add your projects,skills and interest and so on..."></textarea>
      </div>

      <div class="btn-row">
        <button class="btn primary" id="updateBtn">Update Preview</button>
        <button class="btn" id="downloadPdf">Download PDF</button>
        <button class="btn" id="downloadPpt">Download PPTX</button>
        <button class="btn ghost" id="clearAll">Clear All</button>
      </div>

      <div class="footer">Â©2025 developed by Thahsin PM</div>

    </div>

    <div class="preview-wrap">
      <div class="preview" id="previewArea">
        <div class="preview-header">

          <div class="college-header">
            <div class="college-logo" id="collegeLogoPreview">
              <span style="font-size:12px;color:#0b63b0;font-weight:700;">LOGO</span>
            </div>
            <div class="college-details">
              <div class="college-title">B.M.S. COLLEGE OF ENGINEERING</div>
              <div class="college-sub">(Autonomous College, Affiliated to VTU)<br>DEPARTMENT OF INFORMATION SCIENCE AND ENGINEERING</div>
            </div>
          </div>

          <div class="about-title">STUDENT PROFILE</div>

          <div class="content-box">
            <div class="text-flow">
              <div class="bubble" id="b1">
                Your description will appear here...
              </div>
            </div>

            <div class="photo-card">
              <div class="photo-frame" id="photoFrame">
                <img id="studentPhotoPreview" src="" style="display:none">
                <div id="photoPlaceholder" style="color:rgba(255,255,255,0.5)">Student Photo</div>
              </div>

              <div class="tag">
                <div id="previewName2">Your Name</div>
                <small id="previewUSN">USN</small>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="preview-controls"></div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.11.0/dist/pptxgen.bundle.js"></script>

  <script>
    const collegeLogoInput = document.getElementById('collegeLogoInput');
    const studentPhotoInput = document.getElementById('studentPhotoInput');
    const resetCollegeLogo = document.getElementById('resetCollegeLogo');
    const resetStudentPhoto = document.getElementById('resetStudentPhoto');
    const nameInput = document.getElementById('nameInput');
    const usnInput = document.getElementById('usnInput');
    const descInput = document.getElementById('descInput');
    const updateBtn = document.getElementById('updateBtn');
    const downloadPdf = document.getElementById('downloadPdf');
    const downloadPpt = document.getElementById('downloadPpt');
    const clearAll = document.getElementById('clearAll');

    const collegeLogoPreview = document.getElementById('collegeLogoPreview');
    const studentPhotoPreview = document.getElementById('studentPhotoPreview');
    const photoPlaceholder = document.getElementById('photoPlaceholder');
    const previewName1 = document.getElementById('previewName1');
    const previewName2 = document.getElementById('previewName2');
    const previewUSN = document.getElementById('previewUSN');
    const b1 = document.getElementById('b1');
    const previewArea = document.getElementById('previewArea');

    let collegeLogoData = null;
    let studentPhotoData = null;

    function readImageFile(file, callback){
      const fr = new FileReader();
      fr.onload = e => callback(e.target.result);
      fr.readAsDataURL(file);
    }

    collegeLogoInput.addEventListener('change', e=>{
      const f = e.target.files[0];
      if(!f) return;
      readImageFile(f, src=>{
        collegeLogoData = src;
        renderCollegeLogo();
      });
    });

    studentPhotoInput.addEventListener('change', e=>{
      const f = e.target.files[0];
      if(!f) return;
      readImageFile(f, src=>{
        studentPhotoData = src;
        renderStudentPhoto();
      });
    });

    resetCollegeLogo.addEventListener('click', ()=>{
      collegeLogoData=null; collegeLogoInput.value='';
      renderCollegeLogo();
    });

    resetStudentPhoto.addEventListener('click', ()=>{
      studentPhotoData=null; studentPhotoInput.value='';
      renderStudentPhoto();
    });

    function renderCollegeLogo(){
      collegeLogoPreview.innerHTML = '';
      if(collegeLogoData){
        const img = document.createElement('img');
        img.src = collegeLogoData;
        img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover';
        collegeLogoPreview.appendChild(img);
      } else {
        collegeLogoPreview.innerHTML='<span style="font-size:12px;color:#0b63b0;font-weight:700;">LOGO</span>';
      }
    }

    function renderStudentPhoto(){
      if(studentPhotoData){
        studentPhotoPreview.src=studentPhotoData;
        studentPhotoPreview.style.display='block';
        photoPlaceholder.style.display='none';
      } else {
        studentPhotoPreview.style.display='none';
        photoPlaceholder.style.display='block';
      }
    }

    function updatePreview(){
      const name = nameInput.value.trim() || 'Your Name';
      const usn = usnInput.value.trim() || 'USN';
      const desc = descInput.value.trim();

      previewName2.textContent = name;
      previewUSN.textContent = usn;

      // ðŸŸ¦ ***UPDATED PART â€” FULL DESCRIPTION IN ONE BUBBLE***
      b1.textContent = desc || "Your description will appear here as My name is .... I am curently working in .... My interests are.....";

      renderCollegeLogo();
      renderStudentPhoto();
    }

    updateBtn.addEventListener('click', updatePreview);

    clearAll.addEventListener('click', ()=>{
      if(confirm('Clear all fields and preview?')){
        collegeLogoInput.value=''; 
        studentPhotoInput.value=''; 
        nameInput.value=''; 
        usnInput.value=''; 
        descInput.value='';

        collegeLogoData=null;
        studentPhotoData=null;

        updatePreview();
      }
    });

    updatePreview();

    async function exportCanvas(){
      const canvas = await html2canvas(previewArea, {scale:2, useCORS:true, allowTaint:true});
      return canvas;
    }

    downloadPdf.addEventListener('click', async ()=>{
      try{
        downloadPdf.disabled=true;
        downloadPdf.textContent='Preparing...';

        const canvas = await exportCanvas();
        const imgData = canvas.toDataURL('image/png');
        const { jsPDF } = window.jspdf;

        const pdf = new jsPDF({orientation:'landscape',unit:'pt',format:'a4'});
        const pageWidth = pdf.internal.pageSize.getWidth();
        const imgWidth = pageWidth - 40;
        const imgHeight = (canvas.height / canvas.width) * imgWidth;

        pdf.addImage(imgData,'PNG',20,20,imgWidth,imgHeight);
        pdf.save('student_profile.pdf');
      } finally {
        downloadPdf.disabled=false;
        downloadPdf.textContent='Download PDF';
      }
    });

    downloadPpt.addEventListener('click', async ()=>{
      try{
        downloadPpt.disabled=true;
        downloadPpt.textContent='Preparing...';

        const canvas = await exportCanvas();
        const imgData = canvas.toDataURL('image/png');
        const pptx = new PptxGenJS();
        const slide = pptx.addSlide();

        slide.addImage({data:imgData, x:0.1, y:0.1, w:8.6, h:5.1});
        await pptx.writeFile({fileName:'student_profile.pptx'});
      } finally {
        downloadPpt.disabled=false;
        downloadPpt.textContent='Download PPTX';
      }
    });

  </script>

</body>
</html>
